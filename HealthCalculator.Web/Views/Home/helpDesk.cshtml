@model IEnumerable<HealthCalculator.Web.EntityModel.MessageMasterData>
@{
    ViewBag.Title = "helpDesk";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid bg-sky">
    <div class="row">
        <div class="col-12 col-md-12 col-lg-12 text-center pt-3 pb-2">
            <h2 class="semi text-white text-shadow">ACCOUNT SETTINGS</h2>
        </div>
    </div>
</div>

<div class="bg-yellow">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col">
                <ul class="list-inline menu-sec">
                    <li class="list-inline-item"><a href="~/Home/assessment">My Assessment Tool</a></li>
                    <li class="list-inline-item"><a href="~/Home/tracker">My Trackers</a></li>
                    <li class="list-inline-item"><a href="">My Eating Smart Tool</a></li>
                    <li class="list-inline-item"><a href="~/Home/eatingPattern">My Eating Pattern</a></li>
                    <li class="list-inline-item"><a href="~/Home/helpDesk">Admin Messages</a></li>
                    <li class="list-inline-item"><a href="#">Payments</a></li>
                    <li class="list-inline-item active"><a href="~/Home/Logout">Logout</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid flowerBg">
    <div class="row justify-content-center">
        <div class="col-12 col-md-12 col-lg-11">
            <div class="middleContent bg-gray shadow">
                <div class="form-group row">
                    <input type="text" class="form-control border mandotory" id="txtSubject" maxlength="100" placeholder="Enter Subject/Message Title" />
                </div>
                    <div class="row">
                        <div class="col-12 col-md-12">
                            <p class="semi mb-2 text-yellow">SUBMIT YOUR MESSAGE</p>
                            <hr class="mt-0 mb-2 bg-dark" />
                            <input type="hidden" id="hdnMessageID" />
                            <form class="form-data">
                                <div class="form-group">
                                    @using (Html.BeginForm())
                                {
                                  @Html.Action("HtmlEditorPartial")
                                }

                                 

                                </div>
                                <div class="text-right">
                                    <a href="#" class="btn btn-reg mb-2 hvr-sweep-to-top" onclick="SaveMessage()">&nbsp; &nbsp; SUBMIT &nbsp; &nbsp; </a>
                                    <a href="#" class="btn btn-reg mb-2 hvr-sweep-to-top" onclick="Clear()">&nbsp; &nbsp; New Message &nbsp; &nbsp; </a>
                                </div>
                            </form>
                        </div>
                    </div>
                 @foreach(var item in Model)
                 {
                    <div class="bg-yellow container-minus mt-4 mb-4 pt-2 pb-2">
                        <div class="row pt-2">
                            
                            <div class="col-12 col-md-12 col-lg">
                                <p class="semi mb-2 text-white">@item.Subject</p>
                            </div>
                            <div class="col-12 col-md-12 col-lg-5">
                                <p class="semi mb-2 text-white">@item.Addedwhen</p>
                            </div>
                        </div>
                    </div>
                     foreach (var item1 in item.MessageMasterDataList)
                     {
                        <div class="row border">
                            <div class="col-12">
                                <form class="form-data">
                                    <div class="form-group"> 
                                        @Html.Raw(item1.Message)                                     
                                       
                                    </div>
                                    <div class="text-right">
                                        <a href="#" class="btn mb-2 bg-sky hvr-sweep-to-top" onclick="SetMessageID(@item.MessageId)">&nbsp; REPLY &nbsp; </a>
                                    </div>
                                </form>
                            </div>
                        </div>

                     }

                 }
 
                </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    //window.onload = function ()
    //{
    //    CommonAjaxMethod('Program/GetMessage', null, false, 'GET', function (response) {
    //        debugger;
    //        var htmlTopContent = "<div class=" / "row" / "><div class=" / "col-12" / "> <form class=" / "form-data" / ">";
    //        var hmtlBottomContent = "</form></div></div>";
    //        var htmlHeader = "";
    //        var htmlDynamicContent = "";
    //        var currentMessageId = 0;
    //        for (var i = 0; i < response.dataCollection.length; i++)
    //        {
               
    //            if (currentMessageId != response.dataCollection[i].MessageId)
    //            {
    //                currentMessageId = response.dataCollection[i].MessageId;

    //                htmlHeader+="<div class=" / "bg-yellow container-minus mt-4 mb-4 pt-2 pb-2" / "><div class=" / "row pt-2" / "><div class=" / "col-12 col-md-12 col-lg" / "><p class=" / "semi mb-2 text-white" / ">" + response.dataCollection[i].Subject + "</p>" +
    //                   "</div><div class=" / "col-12 col-md-12 col-lg-5" / "><p class=" / "semi mb-2 text-white" / ">" + response.dataCollection[i].AddedWhen + "</p></div></div></div>";

    //                htmlDynamicContent+="<div class=" / "form-group" / "><textarea readonly=" / "readonly" / " rows=" / "10" / " class=" / "form-control" / ">"+response.dataCollection[i].Message+"</textarea> </div>" +
    //                       "<div class=" / "text-right" / "><a href=" / "#" / " class=" / "btn mb-2 bg-sky hvr-sweep-to-top" / ">&nbsp; REPLY TO ADMIN &nbsp; </a></div>";

    //            }
    //            else
    //            {
    //                htmlDynamicContent += "<div class=" / "form-group" / "><textarea readonly=" / "readonly" / " rows=" / "10" / " class=" / "form-control" / ">" + response.dataCollection[i].Message + "</textarea> </div>" +
    //                      "<div class=" / "text-right" / "><a href=" / "#" / " class=" / "btn mb-2 bg-sky hvr-sweep-to-top" / ">&nbsp; REPLY TO ADMIN &nbsp; </a></div>";
    //            }            


    //        }
           
    //        $("#hdnMessageID").innerHTML = htmlHeader+htmlTopContent
    //    });
    //};
   
    function SetMessageID(messageId)
    {
        $("#hdnMessageID").val(messageId);
        CommonAjaxMethod('Program/GetMessage', {MessageId:messageId}, false, 'GET', function (response) {
            $("#txtSubject").val( response.dataCollection[0].Subject);
            $('#txtSubject').prop("disabled", true);
          
           
        });
       
        
    }
    function Clear()
    {
        $("#hdnMessageID").val("");
        $("#txtSubject").val("");
        $('#txtSubject').prop("disabled", false);
      }
   
    function SaveMessage() {
        if (ValidationOnSave()) {
            //    if (ValidateRequiredField()) {
            var MessageMaster =
            {
                MessageId: $("#hdnMessageID").val() == '' ? '0' : $("#hdnMessageID").val().trim(),
                UserID: sessionStorage.getItem('userId'),
                Subject: $("#txtSubject").val() == undefined ? '' : $("#txtSubject").val().trim(),
                Message: HtmlEditor.GetHtml()

            }
            CommonAjaxMethod('Program/SaveMessage', MessageMaster, false, 'POST', function (response) 
            {
                alert('Message save successfully!!!');
                location.reload();

            });
        }

    }
    function ValidationOnSave()
    {
        var isValidReturn = true;
        if( $("#txtSubject").val() == undefined ||$("#txtSubject").val()== '')
        {
            alert("Please enter the Subject.")
            $("#txtSubject").focus();
            isValidReturn=false
        }
        if(isValidReturn)
        {
            if(HtmlEditor.GetHtml()== '')
            {
                alert("Please enter the message.")               
                isValidReturn = false
            }
        }
        return isValidReturn;
    }
        
</script>
