
@{
    ViewBag.Title = "Edit Plan";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container-fluid bg-sky">
    <div class="row">
        <div class="col-12 col-md-12 col-lg-12 text-center pt-3 pb-2">
            <input type="hidden" id="hdnLoginUserId" />
            <h2 class="semi text-white text-shadow">
                <span class="mb-2 dib">ACCOUNT SECTION</span></br>
                <span id="HeaderValue"></span> believe in yourself. You can do it!
                <img src="@CommonMethods.ServerPath/img/smiley.png" class="smiley" style="width: 40px;margin-top: 4px;" />
                <img src="@CommonMethods.ServerPath/img/thumbs.png" style="width: 40px; vertical-align: middle;" />
            </h2>
        </div>
    </div>
</div>

<div class="bg-yellow">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col">
                <ul class="list-inline menu-sec">

                    <li class="list-inline-item"><a href="~/Home/assessment?userId=">My Assessment Tool</a></li>

                    <li class="list-inline-item"> <a href="#" onclick="TrackersHelp(this)">My Trackers<span class="float-right     d-md-block font" style="color: red;" id="spTrackers"></span></a></li>

                    <li class="list-inline-item"><a href="#" onclick="MyEatingSmartTools(this)">My Eating Smart Tool</a></li>


                    <li class="list-inline-item"> <a href="#" onclick="PatternHelp(this)">My Eating Pattern<span class="float-right   d-md-block" style="color: red;" id="spPattern"></span></a></li>

                    <li class="list-inline-item"> <a href="#" onclick="MessageHelp(this)">Admin Messages<span class="float-right   d-md-block" style="color: red;" id="spMessage"></span></a></li>

                    <li class="list-inline-item"><a href="~/Home/ViewPlan?userId=">View Plans</a></li>
                    <li class="list-inline-item active"><a onclick="Logout(this)">Logout</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid flowerBg">
    <div class="row justify-content-center">
        <div class="col-12 col-md-12 col-lg-11">
            <div class="middleContent bg-gray shadow">
                <div class="row">
                    <div class="col-12 col-md-12">
                        <p class="semi mb-2 text-yellow">Edit  Plan</p>
                        <hr class="mt-0 mb-4 bg-dark" />
                        <input type="hidden" id="hdnOrderDetailsID" />
                    </div>
                </div>
                <form class="form-data">
                    <div class="form-group row">
                        <label class="col-12 col-sm-5 col-form-label semi">Program <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <input type="text" class="form-control border mandFree" id="Program" placeholder="Enter Name" readonly="readonly" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12 col-sm-5 col-form-label semi">Product <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <input type="text" class="form-control border mandFree" id="ProductName" placeholder="Enter Name" readonly="readonly" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12 col-sm-5 col-form-label semi">Is Payment Done <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <input type="text" class="form-control border" id="IsPaymentDone" readonly="readonly" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12 col-sm-5 col-form-label semi">Total Days <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <input type="text" class="form-control border mandFree" id="Totaldays" maxlength="100" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-12 col-sm-5 col-form-label semi">Do you want to Activate/Deactivate/Complete the session <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <select class="custom-select mandFree" id="ActivePlan">
                                <option value="" selected>Select</option>
                                <option value="Yes">Activate</option>
                                <option value="No">Deactivate</option>
                                <option value="NA">Completed</option>
                            </select>
                        </div>
                    </div>                    
                    <div class="form-group row">
                        <label class="col-12 col-sm-5 col-form-label semi">Active Start Date <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <input type="date" class="form-control border mandFree" id="StartActiveDate" maxlength="100" placeholder="Enter Start date">
                        </div>
                    </div>
                    <div class="form-group row" style="display:none;">
                        <label class="col-12 col-sm-5 col-form-label semi">Active End Date <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <input type="date" class="form-control border" id="EndActiveDate" maxlength="100" placeholder="Enter end date">
                        </div>
                    </div>

                    <div class="form-group row" style="display:none;">
                        <label class="col-12 col-sm-5 col-form-label semi"> Start Date <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <input type="date" class="form-control border" id="StartDate" maxlength="100" placeholder="Enter end date">
                        </div>
                    </div>
                    
                    <div class="form-group row">
                        <label class="col-12 col-sm-5 col-form-label semi">Do you want to Start program <span class="float-right d-none d-md-block"> : </span></label>
                        <div class="col-12 col-sm-7">
                            <select class="custom-select mandFree" id="IsStarted">                               
                                <option value="1">Yes</option>
                                <option value="0">No</option>                               
                            </select>
                        </div>
                    </div>


                    <div class="form-group row">
                        <div class="col-12 col-sm-12 text-right">
                            <a class="btn btn-reg mb-4 hvr-sweep-to-top" onclick="UpdatePlan()">&nbsp; &nbsp; SUBMIT &nbsp; &nbsp; </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script>
    function ValidateRequiredField() {

        var isRequired = true;
        var x = document.getElementsByClassName("mandFree");
        var i;
        for (i = 0; i < x.length; i++) {

            if (x[i].value == "") {
                isRequired = false;
            }
        }
        return isRequired;
    }
    function MessageHelp(ctrl) {
        var selectedUserId = sessionStorage.getItem('SelectedUserId');
        if (selectedUserId != "") {
            sessionStorage.setItem('userId', selectedUserId);
        }
        ctrl.href = '@Url.Content("~/Home/helpDesk?userId=")' + selectedUserId;
        ctrl.click();
    }
    function TrackersHelp(ctrl)
    {
       var selectedUserId = sessionStorage.getItem('SelectedUserId');
        if (selectedUserId != "") {
            sessionStorage.setItem('userId', selectedUserId);
        }
        ctrl.href = '@Url.Content("~/Home/tracker?userId=")' + selectedUserId;
        ctrl.click();
    }
    function PatternHelp(ctrl)
    {
        var selectedUserId = sessionStorage.getItem('SelectedUserId');
        if (selectedUserId != "") {
            sessionStorage.setItem('userId', selectedUserId);
        }
        ctrl.href = '@Url.Content("~/Home/MyEatingPattern?userId=")' + selectedUserId;
        ctrl.click();
    }

    function Logout(ctrl) {
        sessionStorage.clear();
        ctrl.href = '@Url.Content("~/Home/Logout")';
        ctrl.click();
    }
    window.onload = function () {
        var qData = "@Request.QueryString["orderId"].ToString()";

        $("#hdnOrderDetailsID").val(qData);

        var selectedUserId = sessionStorage.getItem('SelectedUserId');
        if (selectedUserId != "") {
            sessionStorage.setItem('userId', selectedUserId);
        }

       var assessment =
       {
           TableType: "GetRecord",
           UserId: sessionStorage.getItem('userId')
       }
        CommonAjaxMethod('Program/GetAsseeement', assessment, false, 'POST', function (response) {
            if (response.data.Data.Table.length > 0) {
                $("#spMessage").text(" (" + response.data.Data.Table[0].MessageCount + ")");
                $("#spTrackers").text(" (" + response.data.Data.Table[0].Trackerfalldays + ")");
                $("#spPattern").text(" (" + response.data.Data.Table[0].PatternCount + ")");
            }

        });

        CommonAjaxMethod('Home/GetUserPlanOrderDetails', {OrderdetailID:qData, userId: sessionStorage.getItem('userId') }, false, 'GET', function (response)
        {
            $("#Program").val(response.dataCollection[0].Program);
            $("#ProductName").val(response.dataCollection[0].ProductName);
            $("#StartActiveDate").val(getdate(response.dataCollection[0].StartActiveDate));
            $("#EndActiveDate").val(response.dataCollection[0].EndActiveDate);
            $("#Totaldays").val(response.dataCollection[0].Totaldays);
            if (response.dataCollection[0].IsCompleted == "Yes") {
                $("#ActivePlan").val("NA");
            }
            else {


                $("#ActivePlan").val(response.dataCollection[0].ActivePlan);
            }


            $("#IsPaymentDone").val(response.dataCollection[0].IsPaymentDone);
            $("#StartDate").val(response.dataCollection[0].StartDate);
            $("#IsStarted").val(response.dataCollection[0].IsStarted);

        });
        CommonAjaxMethod('Home/GetUserDetailsById', { userId: sessionStorage.getItem('userId') }, false, 'GET', function (response) {
            $("#HeaderValue").text(response.dataCollection[0].FirstName + ",");

        });
    }


    function UpdatePlan() {
        var objData = {
            OrderDetail_Id: $("#hdnOrderDetailsID").val(),
            Program: $("#Program").val(),
            ProductName: $("#ProductName").val(),
            StartActiveDate: $("#StartActiveDate").val(),
            EndActiveDate: $("#EndActiveDate").val(),
            Totaldays: $("#Totaldays").val(),
            ActivePlan: $("#ActivePlan").val(),
            IsPaymentDone: $("#IsPaymentDone").val(),
            StartDate: $("#StartDate").val(),
            IsStarted: $("#IsStarted").val()
        }
        if (ValidateRequiredField()) {
            CommonAjaxMethod('Home/SaveOrderDetails', objData, false, 'POST', function (response) {
                alert("Plan updated successfully.");
            });
        }
        else
        {
            alert("Plan select mandotory details.");
            return false;
        }
    }
    function getdate(strdate) {
        var strRetrunDate;
        if (strdate != null) {
            var dateData = new Date(parseInt(strdate.replace("/Date(", "").replace(")/")));
            var dd = dateData.getDate();
            var mm = dateData.getMonth() + 1; //January is 0!
            var yyyy = dateData.getFullYear();
            if (dd < 10) { dd = '0' + dd }
            if (mm < 10) { mm = '0' + mm }
            strRetrunDate = yyyy + '-' + mm + '-' + dd;
        }
        return strRetrunDate;
    }
    function MyEatingSmartTools(ctrl)
    {
          if (sessionStorage.getItem('IsFreeSession') == "false") {
            var selectedUserId = sessionStorage.getItem('SelectedUserId');
                if (selectedUserId != "") {
                    sessionStorage.setItem('userId', selectedUserId);
                }           
                ctrl.href = '@Url.Content("~/Home/MyEatingSmartTools?userId=")' + sessionStorage.getItem('userId');
            ctrl.click();
        }
        else {
            alert("You dont have sufficient permission on it.")
        return false;}
    }
</script>

